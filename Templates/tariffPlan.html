<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Home Energy Hub - Tariff Plan</title>
	<link rel="stylesheet" href="/static/main.css">
</head>




<%
-- Collect all dayTypes:
local dayTypes = {}
local n = 0
for dayType, schedule in pairs(dayTypeSchedules) do
	n = n + 1
	dayTypes[n] = dayType
end
dayTypes.n = n
table.sort(dayTypes)

-- Collect all exceptionDates into an array (for sorting):
local exceptionDatesArr = {}
n = 0
for exceptionDate, ed in pairs(exceptionDates) do
	n = n + 1
	exceptionDatesArr[n] = ed
end
exceptionDatesArr.n = n
table.sort(exceptionDatesArr, function (aED1, aED2)
	return (aED1.date < aED2.date)
end)
%>




<body>

<h1>Home Energy Hub - Tariff Plan</h1>

<p><a href="/">Home</a></p>



<h2>Seasons</h2>
<% if not(next(dayTypeSchedules)) then %>
<p>There are no day types defined. First add a daytype.</p>
<% else %>
<table>
	<tr>
		<th>Start date</th>
		<th>End date</th>
		<th>Workday daytype</th>
		<th>Weekend daytype</th>
		<th>Action</th>
	</tr>
	<% for _, season in ipairs(seasons) do %>
	<tr>
		<td><%= season.startDate %></td>
		<td><%= season.endDate %></td>
		<td><%= season.workdayDayType %></td>
		<td><%= season.weekendDayType %></td>
	</tr>
	<% end %>
	<tr>
		<form action="/tariffPlan/addNewSeason" method="POST" enctype="multipart/form-data">
		<td><input name="startDate" type="text" value="" /></td>
		<td><input name="endDate"   type="text" value="" /></td>
		<td><select name="workdayDayType">
			<% for _, dayType in ipairs(dayTypes) do %>
			<option value="<%= dayType %>"><%= dayType %></option>
			<% end %>
		</td>
		<td><select name="weekendDayType">
			<% for _, dayType in ipairs(dayTypes) do %>
			<option value="<%= dayType %>"><%= dayType %></option>
			<% end %>
		</td>
		<td>
			<input type="submit" value="Add new" />
		</td>
		</form>
	</tr>
</table>
<% end %>





<h2>Day types / schedules</h2>

<table>
	<tr>
		<th>Day type</th>
		<th>Graph</th>
		<th>Action</th>
	</tr>
	<% for _, dayType in ipairs(dayTypes) do %>
	<tr>
		<td><%= dayType %></td>
		<td><img src="/tariffPlan/dayTypeGraph?dayType=<%= dayType %>&width=720&height=50" width="720" height="50"/></td>
		<td><a href="/tariffPlan/editDayType/<%= dayType %>">Edit</a></td>
	</tr>
	<% end %>
	<tr>
		<td colspan=3>
		<form method="POST" action="/tariffPlan/addNewDayType" enctype="multipart/form-data">
		<input type="submit" value="Add new" />
		</form>
		</td>
	</tr>
</table>





<h2>Exceptions</h2>

<% if not(next(dayTypeSchedules)) then %>
<p>There are no day types defined. First add a daytype.</p>
<% else %>
<table>
	<tr>
		<th>Date</th>
		<th>Day type</th>
		<th>Action</th>
	</tr>
	<% for _, ed in ipairs(exceptionDatesArr) do %>
	<tr>
		<td><%= ed.date %></td>
		<td><%= ed.dayType %></td>
		<td>TODO: Remove</td>
	</tr>
	<% end %>
	<tr>
		<form action="/tariffPlan/addNewExceptionDate" method="POST" enctype="multipart/form-data">
		<td><input name="exceptionDate" type="text" value="" /></td>
		<td><select name="dayType">
			<% for _, dayType in ipairs(dayTypes) do %>
			<option value="<%= dayType %>"><%= dayType %></option>
			<% end %>
		</td>
		<td><input type="submit" value="Add new" /></td>
		</form>
	</tr>
</table>
<% end %>

</body>
</html>
